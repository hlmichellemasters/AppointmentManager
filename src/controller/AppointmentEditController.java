/**
 * Sample Skeleton for 'AppointmentEditScreen.fxml' Controller Class
 */


package controller;

import databaseAccess.*;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.stage.Stage;
import model.Appointment;
import model.Contact;
import model.Customer;
import model.User;

import java.io.IOException;
import java.sql.Time;
import java.time.LocalDateTime;
import java.time.LocalTime;

public class AppointmentEditController {

        @FXML // fx:id="EditApptButton"
        private Button EditApptButton; // Value injected by FXMLLoader

        @FXML // fx:id="DeleteApptButton"
        private Button DeleteApptButton; // Value injected by FXMLLoader

        @FXML // fx:id="apptTableView"
        private TableView<Appointment> apptTableView; // Value injected by FXMLLoader

        @FXML // fx:id="startDateTimeColumn"
        private TableColumn<Appointment, String> startDateTimeColumn; // Value injected by FXMLLoader

        @FXML // fx:id="apptIDColumn"
        private TableColumn<Appointment, Integer> apptIDColumn; // Value injected by FXMLLoader

        @FXML // fx:id="descriptionColumn"
        private TableColumn<Appointment, String> descriptionColumn; // Value injected by FXMLLoader

        @FXML // fx:id="typeColumn"
        private TableColumn<Appointment, String> typeColumn; // Value injected by FXMLLoader

        @FXML // fx:id="locationColumn"
        private TableColumn<Appointment, String> locationColumn; // Value injected by FXMLLoader

        @FXML // fx:id="contactColumn"
        private TableColumn<Appointment, String> contactColumn; // Value injected by FXMLLoader

        @FXML // fx:id="customerColumn"
        private TableColumn<Appointment, String> customerColumn; // Value injected by FXMLLoader

        @FXML // fx:id="endDateTimeColumn"
        private TableColumn<Appointment, String> endDateTimeColumn; // Value injected by FXMLLoader

        @FXML // fx:id="apptIDAutoGeneratedText"
        private Label apptIDAutoGeneratedText; // Value injected by FXMLLoader

        @FXML // fx:id="ApptDescriptionText"
        private TextField ApptDescriptionText; // Value injected by FXMLLoader

        @FXML // fx:id="ApptTypeText"
        private TextField ApptTypeText; // Value injected by FXMLLoader

        @FXML // fx:id="ApptLocationText"
        private TextField ApptLocationText; // Value injected by FXMLLoader

        @FXML // fx:id="ApptCustomerCombo"
        private ComboBox<Customer> ApptCustomerCombo; // Value injected by FXMLLoader

        @FXML // fx:id="ApptStartTimeCombo"
        private ComboBox<LocalTime> ApptStartTimeCombo; // Value injected by FXMLLoader

        @FXML // fx:id="ApptEndTimeCombo"
        private ComboBox<LocalDateTime> ApptEndTimeCombo; // Value injected by FXMLLoader

        @FXML // fx:id="ApptContactCombo"
        private ComboBox<Contact> ApptContactCombo; // Value injected by FXMLLoader

        @FXML // fx:id="ApptUserCombo"
        private ComboBox<User> ApptUserCombo; // Value injected by FXMLLoader

        @FXML // fx:id="ApptStartDatePicker"
        private DatePicker ApptStartDatePicker; // Value injected by FXMLLoader

        @FXML // fx:id="ApptEndDatePicker"
        private DatePicker ApptEndDatePicker; // Value injected by FXMLLoader

        @FXML // fx:id="ApptSaveButon"
        private Button ApptSaveButon; // Value injected by FXMLLoader

        @FXML // fx:id="ApptClearButton"
        private Button ApptClearButton; // Value injected by FXMLLoader

        @FXML // fx:id="ApptEditScreenExit"
        private Button ApptEditScreenExit; // Value injected by FXMLLoader

        ObservableList<Appointment> apptList = FXCollections.observableArrayList();
        ObservableList<Contact> contactList = FXCollections.observableArrayList();
        ObservableList<Customer> customerList = FXCollections.observableArrayList();
        ObservableList<User> userList = FXCollections.observableArrayList();
        ObservableList<LocalTime> startTimeList = FXCollections.observableArrayList();
        ObservableList<LocalTime> endTimeList = FXCollections.observableArrayList();

        public void loadAppointmentsTable() {

                try {

                        apptList.addAll(DbAppointments.getAppointments());
                        System.out.println("Got all Appointments from Database");

                        for (Appointment appt : apptList) {
                                System.out.println(appt);
                        }

                        apptTableView.setItems(apptList);
                        System.out.println("Set list in tableview");

                        startDateTimeColumn.setCellValueFactory(new PropertyValueFactory<>("formattedStart"));
                        apptIDColumn.setCellValueFactory(new PropertyValueFactory<>("apptID"));
                        descriptionColumn.setCellValueFactory(new PropertyValueFactory<>("description"));
                        typeColumn.setCellValueFactory(new PropertyValueFactory<>("type"));
                        locationColumn.setCellValueFactory(new PropertyValueFactory<>("location"));
                        contactColumn.setCellValueFactory(new PropertyValueFactory<>("contact"));
                        customerColumn.setCellValueFactory(new PropertyValueFactory<>("customer"));
                        endDateTimeColumn.setCellValueFactory(new PropertyValueFactory<>("formattedEnd"));

                        System.out.println("Set Up Appointments TableView");

                } catch (Exception e) {
                        System.out.println("Exception Occurred");
                        e.printStackTrace();
                }
        }

        public static void loadAddEditAppt(ActionEvent event) throws IOException {
                FXMLLoader loader = new FXMLLoader();
                loader.setLocation(AppointmentEditController.class.getResource("/view/AppointmentEditScreen.fxml"));
                Parent root = loader.load();
                Scene scene = new Scene(root);

                AppointmentEditController controller = loader.getController();
                controller.loadAppointmentsTable();
                controller.initializeAddEditAppt();

                Stage stage = (Stage) ((Button) event.getSource()).getScene().getWindow();
                ControllerUtilities.centerStage(stage,1400, 845);
                stage.setTitle("Main Appointment");
                stage.setScene(scene);
                stage.show();
        }

        public void initializeAddEditAppt() {
                try {
                        apptIDAutoGeneratedText.setText(String.valueOf(DbCustomers.getNextCustomerID()));
                        contactList.addAll(Contact.getAllContacts());
                        ApptContactCombo.setItems(contactList);
                        customerList.addAll(Customer.getAllCustomers());
                        ApptCustomerCombo.setItems(customerList);
                        userList.addAll(User.getAllUsers());
                        ApptUserCombo.setItems(userList);

                        startTimeList.addAll(utilities.TimeZoneConversions.getAvailableBusinessTimes());
                        ApptStartTimeCombo.setItems(startTimeList);

                } catch (Exception e) {
                        e.printStackTrace();
                }
        }

        @FXML
        void OnApptClearButton(ActionEvent event) {

        }

        @FXML
        void OnApptContactCombo(ActionEvent event) {

        }

        @FXML
        void OnApptCustomerCombo(ActionEvent event) {

        }

        @FXML
        void OnApptEditScreenExit(ActionEvent event) {

        }

        @FXML
        void OnApptEndDatePicker(ActionEvent event) {

        }

        @FXML
        void OnApptEndTimeCombo(ActionEvent event) {

        }

        @FXML
        void OnApptSaveButton(ActionEvent event) {

        }

        @FXML
        void OnApptStartDatePicker(ActionEvent event) {

        }

        @FXML
        void OnApptStartTimeCombo(ActionEvent event) {

        }

        @FXML
        void OnApptUserCombo(ActionEvent event) {

        }

        @FXML
        void OnDeleteApptButton(ActionEvent event) {

        }

        @FXML
        void OnSortApptEditTableView(ActionEvent event) {

        }

    }

